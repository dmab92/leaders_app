# -*- coding: utf-8 -*-
from datetime import datetime
from odoo import models, fields, api, SUPERUSER_ID, _
from odoo import models
#from odoo.exceptions import UserError, Warning, ValidationError
class ReportConcours(models.AbstractModel):
    _name = 'report.leaders_app.blian_cours_xls'
    _inherit = 'report.report_xlsx.abstract'

    @api.model
    def _get_default_academic_year(self):
        academic_year_obj = self.env['leaders.year']
        academic_year_id = academic_year_obj.search([('actived', '=', True)], limit=1)
        return academic_year_id and academic_year_id.id or False

    date_start = fields.Date("Date de debut", default=datetime.today().date())
    date_end = fields.Date("Date de fin")
    year_id = fields.Many2one("leaders.year", string="Année en cours", required=True,
                              default=lambda self: self._get_default_academic_year())

    file_name = fields.Char('Nom du fichier', size=255, readonly=True)
    file_data = fields.Binary('File', readonly=True)
    bool = fields.Boolean('Exporté', readonly=True)

    def generate_xlsx_report(self, workbook,datas, lines):
        domain = []
        date_start = datas.get('date_start')
        if datas.get('date_start'):
            domain += [('date_start', '=', date_start)]
        date_start = datas.get('date_start')
        if datas.get('date_start'):
            domain += [('date_start', '=', date_start)]
        year_id = datas.get('year_id')
        if datas.get('year_id'):
            domain += [('year_id', '=', year_id)]


        ligne_concours_ids = self.env['leaders.enseignement'].search(domain, order=" desc")

        #format1 = workbook.add_format({'font_size': 14, 'align': 'vcenter', 'bold': True})
        format2 = workbook.add_format({'font_size': 12, 'align': 'vcenter'})
        sheet = workbook.add_worksheet("BILAN DES COURS BLANCS")
        data = [
            [' ',
             u' BILAN  DES COURS PAR ENSEIGNANTS DE LA PERIODE ALLANT DU  No '+str(self.date_start) + 'AU',
             +str(self.date_end)],
            [' '],
            [u'RANG', u'NOMS et PRENOMS DE L''ENSEIGNANT', u'NOMS ET PRENOMS DE L''ELEVE ', u'DERNIER ETABLISSEMENT FREQUENTE', u'MATIERE 1',
             u'MATIERE 2', u'MATIERE 3', u'MATIERE 4',
             u'MOYENNE']
        ]

        indis = 1
        for ligne in ligne_concours_ids:
            data.append([indis,
                         ligne.apprenant_id.center_id.name,
                         ligne.apprenant_id.name,
                         ligne.etablissment_id.name,
                         ligne.note_mat1,
                         ligne.note_mat2,
                         ligne.note_mat3,
                         ligne.note_mat4,
                         ligne.average,
                         ])
            indis = indis + 1
            # On ecris le data dans les lignes et colones du fichiers excel
        for i in range(len(data)):
            for j in range(len(data[i])):
                if j < len(data[i]):
                    sheet.write(i, j, data[i][j], format2)

















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































